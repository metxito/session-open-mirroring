<table class="table table-bordered">
    <thead>
        <tr>
            <th>ID</th>
            <th>Connection</th>
            <th>Object</th>
            <th>Queries</th>
            <th>Unique Keys</th>
            <th>LSN</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for row in queries %}
        <tr class="{% if not row.active %}inactive{% endif %}">
            <td>{{ row.id }}</td>
            <td style="max-width: 200px;">{{ row.connection_name }}</td>
            <td>{{ row.schema }}.{{ row.table }}</td>
            <td style="white-space: pre-wrap; word-break: break-word; min-width: 300px;">{{ row.query_incremental }}</td>
            <td style="min-width: 150px;">{{ row.unique_keys }}</td>
            <td style="min-width: 150px;">{{ row.current_lsn }}<br>{{ row.next_file_sequence_txt }}</td>
            <td style="text-decoration: none; display: flex; flex-direction: column; gap: 6px;">
                <form method="post" action="/restart/{{ row.id }}" style="display:inline; width: 100%;" onsubmit="if(confirm('¿Estás seguro de que deseas reiniciar este registro?')) { alert('The object {{ row.schema }}.{{ row.table }} has been reset'); return true; } return false;">
                    <button type="submit" class="btn btn-warning btn-sm" {% if not row.active %}disabled{% endif %} style="width: 100%;">Restart</button>
                </form>
                <button type="button" class="btn btn-primary btn-sm" onclick="document.getElementById('modal-{{ row.id }}').style.display='block'" {% if not row.active %}disabled{% endif %}>Edit</button>
                <form method="post" action="/delete_query/{{ row.id }}" style="display:inline; width: 100%;" onsubmit="return confirm('Are you sure you want to delete this record?');">
                    <button type="submit" class="btn btn-danger btn-sm" style="width: 100%;">Delete</button>
                </form>
                <form method="post" action="/toggle_active/{{ row.id }}" style="display:inline; width: 100%;">
                    <button type="submit" class="btn btn-sm {{ 'btn-success' if row.active else 'btn-secondary' }}" style="width: 100%;">
                        {{ 'Deactivate' if row.active else 'Activate' }}
                    </button>
                </form>
                <div id="modal-{{ row.id }}" class="custom-modal" style="display:none;">
                    <div class="custom-modal-content">
                        <span class="close" onclick="document.getElementById('modal-{{ row.id }}').style.display='none'">&times;</span>
                        <form id="edit-form-{{ row.id }}" method="post" action="/edit_query/{{ row.id }}">
                            <div class="form-group">
                                <label>Query get changes</label>
                                <input type="text" name="query_incremental" class="form-control" value="{{ row.query_incremental }}">
                            </div>
                            <div class="form-group">
                                <label>Unique Keys</label>
                                <input type="text" name="unique_keys" class="form-control" value="{{ row.unique_keys }}">
                            </div>
                            <button type="submit" class="btn btn-success btn-sm">Save</button>
                            <button type="button" class="btn btn-secondary btn-sm" onclick="document.getElementById('modal-{{ row.id }}').style.display='none'">Cancel</button>
                        </form>        
                    </div>
                </div>        
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
